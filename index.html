<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>弁当ナビ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- セットアップ通知（初期は非表示、JSで制御） -->
    <div class="setup-notice" id="setupNotice" style="display: none;">
        <div class="setup-notice-content">
            <span>スプレッドシートが未設定です。初回セットアップを行ってください。</span>
            <button class="setup-notice-btn" id="setupNoticeBtn">設定する</button>
        </div>
    </div>

    <!-- ヘッダー -->
    <header class="header">
        <div class="header-inner">
            <a href="/" class="logo">弁当ナビ</a>
            <nav class="nav">
                <button class="btn-settings" id="openSettings">設定</button>
                <button class="btn-add" id="openModal">お店を登録</button>
            </nav>
        </div>
    </header>

    <!-- フィルターセクション -->
    <section class="filters" id="shops">
        <div class="container">
            <div class="filter-bar">
                <div class="filter-group">
                    <label class="filter-label">カテゴリ</label>
                    <div class="category-chips" id="categoryChips">
                        <!-- 動的に生成される -->
                    </div>
                </div>
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">配達エリア</label>
                        <select class="filter-select" id="areaFilter">
                            <option value="all">すべてのエリア</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">価格帯</label>
                        <select class="filter-select" id="priceFilter">
                            <option value="all">すべての価格</option>
                            <option value="under500">〜500円</option>
                            <option value="500to800">500〜800円</option>
                            <option value="800to1000">800〜1,000円</option>
                            <option value="over1000">1,000円〜</option>
                        </select>
                    </div>
                    <div class="filter-group search-group">
                        <label class="filter-label">キーワード</label>
                        <input type="text" class="filter-input" id="searchInput" placeholder="店名で検索...">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 店舗一覧 -->
    <section class="shops-section">
        <div class="container">
            <div class="shops-header">
                <h2 class="shops-title">お弁当屋さん一覧</h2>
                <p class="shops-count"><span id="shopCount">0</span>件</p>
            </div>
            <div class="shops-grid" id="shopsGrid"></div>
            <div class="no-results" id="noResults" style="display: none;">
                <p>該当するお店が見つかりませんでした</p>
            </div>
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>読み込み中...</p>
            </div>
        </div>
    </section>

    <!-- 登録モーダル -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">お店を登録</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <form class="modal-form" id="shopForm">
                <div class="form-group">
                    <label class="form-label">お店のURL <span class="required">*</span></label>
                    <div class="url-input-wrapper">
                        <input type="url" class="form-input" id="shopUrl" placeholder="https://example.com" required>
                        <button type="button" class="btn-fetch" id="fetchBtn">情報取得</button>
                    </div>
                    <p class="form-hint">URLを入力またはペーストすると自動で情報を取得します</p>
                </div>

                <div class="preview-card" id="previewCard" style="display: none;">
                    <img src="" alt="" class="preview-image" id="previewImage">
                    <div class="preview-info">
                        <p class="preview-title" id="previewTitle"></p>
                        <p class="preview-url" id="previewUrl"></p>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">店名 <span class="required">*</span></label>
                        <input type="text" class="form-input" id="shopName" placeholder="お弁当屋さんの名前" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">カテゴリ <span class="required">*</span></label>
                        <div class="category-checkboxes" id="shopCategoryCheckboxes">
                            <!-- 動的に生成される -->
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">配達エリア <span class="required">*</span></label>
                        <input type="text" class="form-input" id="shopArea" placeholder="例: 渋谷区、新宿区" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">価格帯 <span class="required">*</span></label>
                        <select class="form-select" id="shopPrice" required>
                            <option value="">選択してください</option>
                            <option value="under500">〜500円</option>
                            <option value="500to800">500〜800円</option>
                            <option value="800to1000">800〜1,000円</option>
                            <option value="over1000">1,000円〜</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">サムネイル画像URL</label>
                    <input type="url" class="form-input" id="shopImage" placeholder="https://example.com/image.jpg">
                </div>

                <div class="form-group">
                    <label class="form-label">メモ</label>
                    <textarea class="form-textarea" id="shopDescription" placeholder="おすすめポイントなど"></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-cancel" id="cancelBtn">キャンセル</button>
                    <button type="submit" class="btn-submit">登録する</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 設定モーダル -->
    <div class="modal-overlay" id="settingsOverlay">
        <div class="modal modal-settings">
            <div class="modal-header">
                <h2 class="modal-title">スプレッドシート設定</h2>
                <button class="modal-close" id="closeSettings">&times;</button>
            </div>
            <div class="modal-form">
                <div class="settings-status" id="settingsStatus">
                    <span class="status-indicator status-demo"></span>
                    <span>未設定（デモモード）</span>
                </div>

                <div class="settings-guide">
                    <h3>セットアップ手順</h3>
                    <ol>
                        <li>Googleスプレッドシートを新規作成</li>
                        <li>「拡張機能」→「Apps Script」を開く</li>
                        <li>下のボタンでコードをコピーして貼り付け</li>
                        <li>「デプロイ」→「新しいデプロイ」→「ウェブアプリ」</li>
                        <li>アクセスできるユーザー：「全員」に設定</li>
                        <li>デプロイしてURLを取得</li>
                        <li>下の欄にURLを入力して「セットアップを実行」</li>
                    </ol>
                    <p class="form-hint">※GASコードを更新した場合は、再度「セットアップを実行」してください</p>
                    <button type="button" class="btn-copy-code" id="copyGasCode">GASコードをコピー</button>
                </div>

                <div class="form-group">
                    <label class="form-label">Google Apps Script Web App URL</label>
                    <input type="url" class="form-input" id="gasUrl" placeholder="https://script.google.com/macros/s/xxxxx/exec">
                </div>

                <div class="settings-actions">
                    <button type="button" class="btn-secondary" id="testConnection">接続テスト</button>
                    <button type="button" class="btn-primary" id="runSetup">セットアップを実行</button>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-danger" id="resetSettings">設定をリセット</button>
                    <button type="button" class="btn-cancel" id="cancelSettings">閉じる</button>
                </div>

                <!-- カテゴリ管理 -->
                <div class="settings-section">
                    <h3>カテゴリ管理</h3>
                    <div class="category-add-form">
                        <input type="text" class="form-input" id="newCategoryName" placeholder="カテゴリ名（例: 和食）">
                        <button type="button" class="btn-secondary" id="addCategoryBtn">追加</button>
                    </div>
                    <div class="category-list" id="categoryList">
                        <!-- カテゴリ一覧がここに表示される -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- トースト -->
    <div class="toast" id="toast">
        <span class="toast-message" id="toastMessage"></span>
    </div>

    <!-- フッター -->
    <footer class="footer">
        <div class="container">
            <p class="footer-text">弁当ナビ</p>
        </div>
    </footer>

    <!-- JavaScript（フラット構造用） -->
    <script src="config.js"></script>
    <script src="api.js"></script>
    <script src="ui.js"></script>
    <script src="app.js"></script>
</body>
</html>
