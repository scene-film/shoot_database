<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ロケナビ</title>
    
    <link rel="dns-prefetch" href="https://script.google.com">
    <link rel="preconnect" href="https://script.google.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- サイドバー -->
    <aside class="sidebar">
        <div class="sidebar-logo">ロケナビ</div>
        <nav class="sidebar-nav">
            <button class="sidebar-btn active" data-page="bento" title="弁当">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="6" width="18" height="12" rx="2"/>
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="12" y1="6" x2="12" y2="18"/>
                </svg>
                <span>弁当</span>
            </button>
            <button class="sidebar-btn" data-page="location" title="ロケ地">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                    <circle cx="12" cy="10" r="3"/>
                </svg>
                <span>ロケ地</span>
            </button>
        </nav>
        <button class="sidebar-settings" id="openSettings" title="設定">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
            </svg>
        </button>
    </aside>

    <!-- メインコンテンツ -->
    <main class="main-content">
        <!-- セットアップ通知 -->
        <div class="setup-notice" id="setupNotice" style="display: none;">
            <div class="setup-notice-content">
                <span>スプレッドシートが未設定です。初回セットアップを行ってください。</span>
                <button class="setup-notice-btn" id="setupNoticeBtn">設定する</button>
            </div>
        </div>

        <!-- ========== 弁当ページ ========== -->
        <div class="page active" id="bentoPage">
            <header class="header">
                <div class="header-inner">
                    <h1 class="page-title">弁当</h1>
                    <button class="btn-add" id="openBentoModal">お店を登録</button>
                </div>
                <div class="header-filters">
                    <div class="header-filters-inner">
                        <div class="filter-group filter-category">
                            <label class="filter-label">カテゴリ</label>
                            <div class="category-chips" id="bentoCategoryChips"></div>
                        </div>
                        <div class="filter-row">
                            <div class="filter-group">
                                <label class="filter-label">エリア</label>
                                <select class="filter-select" id="bentoAreaFilter"></select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">価格帯</label>
                                <select class="filter-select" id="bentoPriceFilter">
                                    <option value="all">すべての価格</option>
                                    <option value="under500">〜500円</option>
                                    <option value="500to800">500〜800円</option>
                                    <option value="800to1000">800〜1,000円</option>
                                    <option value="over1000">1,000円〜</option>
                                </select>
                            </div>
                            <div class="filter-group search-group">
                                <label class="filter-label">検索</label>
                                <input type="text" class="filter-input" id="bentoSearchInput" placeholder="店名で検索...">
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <section class="items-section">
                <div class="container">
                    <div class="items-header">
                        <p class="items-count"><span id="bentoCount">0</span>件</p>
                    </div>
                    <div class="items-grid" id="bentoGrid"></div>
                    <div class="no-results" id="bentoNoResults" style="display: none;">
                        <p>該当するお店が見つかりませんでした</p>
                    </div>
                    <div class="loading" id="bentoLoading">
                        <div class="loading-spinner"></div>
                        <p>読み込み中...</p>
                    </div>
                </div>
            </section>
        </div>

        <!-- ========== ロケ地ページ ========== -->
        <div class="page" id="locationPage">
            <header class="header">
                <div class="header-inner">
                    <h1 class="page-title">ロケ地</h1>
                    <button class="btn-add" id="openLocationModal">ロケ地を登録</button>
                </div>
                <div class="header-filters">
                    <div class="header-filters-inner">
                        <div class="filter-group filter-category">
                            <label class="filter-label">カテゴリ</label>
                            <div class="category-chips" id="locationCategoryChips"></div>
                        </div>
                        <div class="filter-row">
                            <div class="filter-group">
                                <label class="filter-label">エリア</label>
                                <select class="filter-select" id="locationAreaFilter"></select>
                            </div>
                            <div class="filter-group search-group">
                                <label class="filter-label">検索</label>
                                <input type="text" class="filter-input" id="locationSearchInput" placeholder="ロケ地名で検索...">
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <section class="items-section">
                <div class="container">
                    <div class="items-header">
                        <p class="items-count"><span id="locationCount">0</span>件</p>
                    </div>
                    <div class="items-grid" id="locationGrid"></div>
                    <div class="no-results" id="locationNoResults" style="display: none;">
                        <p>該当するロケ地が見つかりませんでした</p>
                    </div>
                    <div class="loading" id="locationLoading">
                        <div class="loading-spinner"></div>
                        <p>読み込み中...</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- 弁当登録モーダル -->
    <div class="modal-overlay" id="bentoModalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">お店を登録</h2>
                <button class="modal-close" id="closeBentoModal">&times;</button>
            </div>
            <form class="modal-form" id="bentoForm">
                <div class="form-group">
                    <label class="form-label">お店のURL <span class="required">*</span></label>
                    <input type="url" class="form-input" id="bentoUrl" placeholder="https://... （入力すると自動で情報取得）" required>
                    <div class="fetch-status" id="bentoFetchStatus"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">画像プレビュー</label>
                    <div class="image-preview" id="bentoImagePreview">
                        <span class="preview-placeholder">画像URLを入力するとプレビュー表示</span>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">店舗名 <span class="required">*</span></label>
                        <input type="text" class="form-input" id="bentoName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">画像URL</label>
                        <input type="url" class="form-input" id="bentoImage" placeholder="https://...">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">カテゴリ <span class="required">*</span></label>
                    <div class="category-checkboxes" id="bentoCategoryCheckboxes"></div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">配達エリア <span class="required">*</span></label>
                        <div class="category-checkboxes" id="bentoAreaCheckboxes"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">価格帯 <span class="required">*</span></label>
                        <select class="form-select" id="bentoPrice" required>
                            <option value="">選択してください</option>
                            <option value="under500">〜500円</option>
                            <option value="500to800">500〜800円</option>
                            <option value="800to1000">800〜1,000円</option>
                            <option value="over1000">1,000円〜</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">説明</label>
                    <textarea class="form-textarea" id="bentoDescription" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary" id="bentoSubmit">登録する</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ロケ地登録モーダル -->
    <div class="modal-overlay" id="locationModalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ロケ地を登録</h2>
                <button class="modal-close" id="closeLocationModal">&times;</button>
            </div>
            <form class="modal-form" id="locationForm">
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input type="url" class="form-input" id="locationUrl" placeholder="https://... （入力すると自動で情報取得）">
                    <div class="fetch-status" id="locationFetchStatus"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">画像プレビュー</label>
                    <div class="image-preview" id="locationImagePreview">
                        <span class="preview-placeholder">画像URLを入力するとプレビュー表示</span>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ロケ地名 <span class="required">*</span></label>
                        <input type="text" class="form-input" id="locationName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">画像URL</label>
                        <input type="url" class="form-input" id="locationImage" placeholder="https://...">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">カテゴリ <span class="required">*</span></label>
                    <div class="category-checkboxes" id="locationCategoryCheckboxes"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">エリア <span class="required">*</span></label>
                    <div class="category-checkboxes" id="locationAreaCheckboxes"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">住所</label>
                    <input type="text" class="form-input" id="locationAddress" placeholder="東京都...">
                </div>
                <div class="form-group">
                    <label class="form-label">説明・メモ</label>
                    <textarea class="form-textarea" id="locationDescription" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary" id="locationSubmit">登録する</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 弁当編集モーダル -->
    <div class="modal-overlay" id="bentoEditOverlay">
        <div class="modal" id="bentoEditModal">
            <div class="modal-header">
                <h2 class="modal-title">店舗情報を編集</h2>
                <button class="modal-close" id="closeBentoEdit">&times;</button>
            </div>
            <div class="modal-body">
                <form id="bentoEditForm">
                    <input type="hidden" id="bentoEditId">
                    <div class="form-group">
                        <label class="form-label">URL <span class="required">*</span></label>
                        <input type="url" class="form-input" id="bentoEditUrl" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">店舗名 <span class="required">*</span></label>
                        <input type="text" class="form-input" id="bentoEditName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">カテゴリ <span class="required">*</span></label>
                        <div class="category-checkboxes" id="bentoEditCategoryCheckboxes"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">配達エリア <span class="required">*</span></label>
                            <div class="category-checkboxes" id="bentoEditAreaCheckboxes"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">価格帯 <span class="required">*</span></label>
                            <select class="form-select" id="bentoEditPrice" required>
                                <option value="">選択してください</option>
                                <option value="under500">〜500円</option>
                                <option value="500to800">500〜800円</option>
                                <option value="800to1000">800〜1,000円</option>
                                <option value="over1000">1,000円〜</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">画像URL</label>
                        <input type="url" class="form-input" id="bentoEditImage">
                    </div>
                    <div class="form-group">
                        <label class="form-label">説明</label>
                        <textarea class="form-textarea" id="bentoEditDescription" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="cancelBentoEdit">キャンセル</button>
                        <button type="submit" class="btn-primary" id="saveBentoEdit">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ロケ地編集モーダル -->
    <div class="modal-overlay" id="locationEditOverlay">
        <div class="modal" id="locationEditModal">
            <div class="modal-header">
                <h2 class="modal-title">ロケ地情報を編集</h2>
                <button class="modal-close" id="closeLocationEdit">&times;</button>
            </div>
            <div class="modal-body">
                <form id="locationEditForm">
                    <input type="hidden" id="locationEditId">
                    <div class="form-group">
                        <label class="form-label">URL</label>
                        <input type="url" class="form-input" id="locationEditUrl">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ロケ地名 <span class="required">*</span></label>
                        <input type="text" class="form-input" id="locationEditName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">カテゴリ <span class="required">*</span></label>
                        <div class="category-checkboxes" id="locationEditCategoryCheckboxes"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">エリア <span class="required">*</span></label>
                        <div class="category-checkboxes" id="locationEditAreaCheckboxes"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">住所</label>
                        <input type="text" class="form-input" id="locationEditAddress">
                    </div>
                    <div class="form-group">
                        <label class="form-label">画像URL</label>
                        <input type="url" class="form-input" id="locationEditImage">
                    </div>
                    <div class="form-group">
                        <label class="form-label">説明</label>
                        <textarea class="form-textarea" id="locationEditDescription" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="cancelLocationEdit">キャンセル</button>
                        <button type="submit" class="btn-primary" id="saveLocationEdit">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 設定モーダル -->
    <div class="modal-overlay" id="settingsOverlay">
        <div class="modal modal-settings">
            <div class="modal-header">
                <h2 class="modal-title">スプレッドシート設定</h2>
                <button class="modal-close" id="closeSettings">&times;</button>
            </div>
            <div class="modal-form">
                <div class="settings-status" id="settingsStatus">
                    <span class="status-indicator status-demo"></span>
                    <span>未設定（デモモード）</span>
                </div>

                <div class="settings-guide">
                    <h3>セットアップ手順</h3>
                    <ol>
                        <li>Googleスプレッドシートを新規作成</li>
                        <li>「拡張機能」→「Apps Script」を開く</li>
                        <li>下のボタンでコードをコピーして貼り付け</li>
                        <li>「デプロイ」→「新しいデプロイ」→「ウェブアプリ」</li>
                        <li>アクセスできるユーザー：「全員」に設定</li>
                        <li>デプロイしてURLを取得</li>
                        <li>下の欄にURLを入力して「セットアップを実行」</li>
                    </ol>
                    <p class="form-hint">※GASコードを更新した場合は、再度「セットアップを実行」してください</p>
                    <button type="button" class="btn-copy-code" id="copyGasCode">GASコードをコピー</button>
                </div>

                <div class="settings-section">
                    <h3>GAS URL</h3>
                    <input type="url" class="form-input" id="gasUrl" placeholder="https://script.google.com/...">
                    <div class="settings-actions">
                        <button type="button" class="btn-secondary" id="testConnection">接続テスト</button>
                        <button type="button" class="btn-primary" id="runSetup">セットアップを実行</button>
                    </div>
                </div>

                <!-- 弁当カテゴリ管理 -->
                <div class="settings-section">
                    <h3>弁当カテゴリ管理</h3>
                    <div class="category-add-form">
                        <input type="text" class="form-input" id="newBentoCategoryName" placeholder="カテゴリ名">
                        <button type="button" class="btn-secondary" id="addBentoCategoryBtn">追加</button>
                    </div>
                    <div class="category-list" id="bentoCategoryList"></div>
                </div>

                <!-- 弁当エリア管理 -->
                <div class="settings-section">
                    <h3>弁当エリア管理</h3>
                    <div class="category-add-form">
                        <input type="text" class="form-input" id="newBentoAreaName" placeholder="エリア名">
                        <button type="button" class="btn-secondary" id="addBentoAreaBtn">追加</button>
                    </div>
                    <div class="category-list" id="bentoAreaList"></div>
                </div>

                <!-- ロケ地カテゴリ管理 -->
                <div class="settings-section">
                    <h3>ロケ地カテゴリ管理</h3>
                    <div class="category-add-form">
                        <input type="text" class="form-input" id="newLocationCategoryName" placeholder="カテゴリ名">
                        <button type="button" class="btn-secondary" id="addLocationCategoryBtn">追加</button>
                    </div>
                    <div class="category-list" id="locationCategoryList"></div>
                </div>

                <!-- ロケ地エリア管理 -->
                <div class="settings-section">
                    <h3>ロケ地エリア管理</h3>
                    <div class="category-add-form">
                        <input type="text" class="form-input" id="newLocationAreaName" placeholder="エリア名">
                        <button type="button" class="btn-secondary" id="addLocationAreaBtn">追加</button>
                    </div>
                    <div class="category-list" id="locationAreaList"></div>
                </div>

                <div class="settings-section">
                    <button type="button" class="btn-danger" id="resetSettings">設定をリセット</button>
                </div>
            </div>
        </div>
    </div>

    <!-- トースト -->
    <div class="toast" id="toast"></div>

    <script src="config.js"></script>
    <script src="api.js"></script>
    <script src="ui.js"></script>
    <script src="app.js"></script>
</body>
</html>
